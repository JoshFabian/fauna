- if !user_signed_in?
  = render partial: "listings/guest_message"

.row
  - if @message.present?
    - if @message == 'canceled'
      %div.alert-box.alert{:'data-alert' => ''}
        Your payment was canceled
    - elsif @message == 'sold'
      %div.alert-box.success{:'data-alert' => ''}
        Your payment is complete

  .list-panel
    .listing-images.small-7.columns
      .main-image
        -# image is filled via js
        = image_tag nil

      .more-images
        %ul.image-grid.small-block-grid-5
          - @all_images.each do |image|
            %li{:'data-image-url' => cloudinary_url(image.full_public_id), :'data-transform' => "c_fit,w_600"}
              = image_tag cloudinary_url(image.full_public_id, transformation: [{width: 110, height: 80, crop: 'fill'}])
      .small-12.columns
        %ul.pills{:'data-tab' => ""}
          %li.tab-title.active{:'data-pill' => 'description'}
            %a{href: "#"} Description
          %li.tab-title{:'data-pill' => 'reviews'}
            %a{href: "#"} Reviews
          %li.tab-title{:'data-pill' => 'shipping'}
            %a{href: "#"} Shipping
        .pills-content
          #description.content
            %p= @listing.description
          #reviews.content.hide
            = render(partial: "reviews/review", locals: {reviews: @reviews})
          #shipping.content.hide
            = render(partial: "listings/shipping_content")

    .listing-aside.small-5.columns
      .category-breadcrumbs
        %span
          - if @category.present?
            = link_to @category.name, listing_category_path(@category.name.parameterize)
            - if @subcategory.present?
              %i.icon.ion-ios7-arrow-forward
              = link_to @subcategory.name, listing_category_path(@category.name.parameterize, @subcategory.name.parameterize)

      %h4= @listing.title
      %h1
        = number_to_currency(@listing.price.to_f/100.0, precision: 2)
        = select_tag "listing[shipping_to]", options_for_select(listing_shipping_prices_options(@listing)), class: 'shipping-selector shipping-dropdown', prompt: "Select Shipping", :'data-listing-id' => @listing.id
        = link_to 'Checkout with Paypal', '#', class: 'button buy-button checkout secondary disabled', :'data-listing-id' => @listing.id

      = link_to 'Ask a question', '#', class: 'button ask-question', :'data-reveal-id' => 'listing-message-modal'
      = link_to 'Report Listing', '#', class: 'remove-link', :'data-reveal-id' => 'listing-report-modal'

      -# subtotal disabled
      -# %hr
      -# 
      -# .small-12.columns.no-padding
      -#   %ul
      -#     %li.checkout-subtotal
      -#       .small-9.columns.text-right
      -#         subtotal:
      -#       .small-3.columns.text-left.price
      -#         = number_to_currency(@listing.price/100.0)
      -#     %li.checkout-shipping
      -#       .small-9.columns.text-right
      -#         shipping:
      -#       .small-3.columns.text-left.price
      -#     %li.checkout-total
      -#       .small-9.columns.text-right
      -#         %strong Total:
      -#       .small-3.columns.text-left.price
      -#         %strong

    = render(partial: 'listings/listing_message_modal')
    = render(partial: 'listings/listing_report_modal')

    #fb-root
    :javascript
      (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0];
        if (d.getElementById(id)) return;
        js = d.createElement(s); js.id = id;
        js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.0";
        fjs.parentNode.insertBefore(js, fjs);
      }(document, 'script', 'facebook-jssdk'));